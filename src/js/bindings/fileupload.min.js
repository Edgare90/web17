"use strict";var $=require("jquery"),ko=require("knockout"),console=require("console");ko.bindingHandlers.preloader={init:function(e,t){var i=t();if("undefined"==typeof i.preloaded){i.preloaded=ko.observable("");var r=function(e){if(e!=i.preloaded())if(""!==e){var t=new Image;t.onload=function(){i.preloaded(e)},t.onerror=function(){i.preloaded(e)},t.src=e}else i.preloaded(e)};i.subscribe(r),r(i())}}},ko.bindingHandlers.advattr={init:function(e,t,i,r,n){var o=ko.utils.unwrapObservable(t()||{});ko.utils.objectForEach(o,function(t,i){var r=e.getAttribute(t);if(ko.isWriteableObservable(i)){var n=i();n!=r&&(i(r),null!==n&&console.log("AdvAttr found a value different from the default",t,n,r))}})},update:function(e,t,i){var r=ko.utils.unwrapObservable(t())||{};ko.utils.objectForEach(r,function(t,i){i=ko.utils.unwrapObservable(i);var r=i===!1||null===i||void 0===i;r?e.removeAttribute(t):e.setAttribute(t,i.toString())})}},ko.bindingHandlers.advstyle={init:function(e,t,i,r,n){var o=ko.utils.unwrapObservable(t()||{});ko.utils.objectForEach(o,function(t,i){var r;if(t.match(/Px$/)?(t=t.substr(0,t.length-2),r=e.style[t],r.match(/px$/)?r=r.replace(/px$/,""):console.log("AdvStyle binding found an unexpected default value",t,r,e)):r=e.style[t],ko.isWriteableObservable(i)){var n=i();n!=r&&(i(r),null!==n&&console.log("AdvStyle found a value different from the default",t,n,r))}})},update:function(e,t){var i=ko.utils.unwrapObservable(t()||{});ko.utils.objectForEach(i,function(t,i){i=ko.utils.unwrapObservable(i),(null===i||"undefined"==typeof i||i===!1)&&(i=""),t.match(/Px$/)&&(t=t.substr(0,t.length-2),i+="px"),e.style[t]=i})}},ko.bindingHandlers.domlog={init:function(e,t){console.log("initialized",e),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){console.log("disposed",e)})}},ko.bindingHandlers.fudroppable={init:function(e,t){var i=t()||{},r={},n=function(e,t,i,r,n,o){e[t]?global.clearTimeout(e[t]):("undefined"!=typeof r&&i.classList.add(r),ko.isWriteableObservable(n)&&!n()&&n(!0));var a=function(){e[t]=null,"undefined"!=typeof r&&i.classList.remove(r),ko.isWriteableObservable(n)&&n()&&n(!1)};"dragleave"==o.type?a():e[t]=global.setTimeout(a,500)};(i.active||i.activeClass)&&ko.utils.registerEventHandler(global,"dragover",n.bind(void 0,r,"activeTimeout",e,i.activeClass,i.active)),i.hoverClass&&ko.utils.registerEventHandler(e,"dragover dragenter dragleave",n.bind(void 0,r,"hoverTimeout",e,i.hoverClass,void 0))}},ko.bindingHandlers.fileupload={extendOptions:{},remoteFilePreprocessor:function(e){return e},init:function(e,t){ko.utils.domNodeDisposal.addDisposeCallback(e,function(){$(e).fileupload("destroy")}),global.webkitURL?$(e).attr("title"," "):$(e).attr("title","")},update:function(e,t){var i=t()||{},r=$(e),n=r.parents(".uploadzone"),o=i.data;i.data=void 0;var a=i.canvasPreview;ko.utils.extend(i,{url:"/upload/",dataType:"json",dropZone:n.find(".mo-uploadzone")[0],autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:1048576,disableImageResize:/Android(?!.*Chrome)|Opera/.test(global.navigator.userAgent),previewMaxWidth:200,previewMaxHeight:200,previewCrop:!1,replaceFileInput:!1,messages:{unknownError:"Unknown error",uploadedBytes:"Uploaded bytes exceed file size",maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small",post_max_size:"The uploaded file exceeds the post_max_size directive in php.ini",max_file_size:"File is too big",min_file_size:"File is too small",accept_file_types:"Filetype not allowed",max_number_of_files:"Maximum number of files exceeded",max_width:"Image exceeds maximum width",min_width:"Image requires a minimum width",max_height:"Image exceeds maximum height",min_height:"Image requires a minimum height",abort:"File upload aborted",image_resize:"Failed to resize image",generic:"Unexpected upload error"}}),ko.utils.extend(i,ko.bindingHandlers.fileupload.extendOptions);var s=0,l="",d=function(){0===--s&&(o&&o(l),l="",a&&(n.find("img").show(),n.find("canvas").remove()),n.removeClass("uploading"),n.find(".progress-bar").css("width",0))},c=function(e){if("object"==typeof i.messages&&null!==i.messages){var t=e.match(/^([^ ]+)(.*)$/);if(t&&"undefined"!=typeof i.messages[t[1]])return i.messages[t[1]]+t[2]}return e};r.fileupload(i);for(var u=["fileuploadadd","fileuploadprocessalways","fileuploadprogressall","fileuploaddone","fileuploadfail"],f=function(e,t){if("fileuploadadd"==e.type&&s++,"fileuploadfail"==e.type&&(console.log("fileuploadfail",e,t),i.onerror&&(""===t.errorThrown&&"error"==t.textStatus?i.onerror(c("generic")):i.onerror(c("generic ("+t.errorThrown+")"))),d()),"fileuploaddone"==e.type)if("undefined"!=typeof t.result.files[0].url){if(i.onfile)for(var r=0;r<t.result.files.length;r++)t.result.files[r]=ko.bindingHandlers.fileupload.remoteFilePreprocessor(t.result.files[r]),i.onfile(t.result.files[r]);if(""===l&&(l=t.result.files[0].url),a){var o=new Image;o.onload=d,o.onerror=d,o.src=t.result.files[0].url}else d()}else"undefined"!=typeof t.result.files[0].error?(console.log("remote error",e,t),i.onerror&&i.onerror(c(t.result.files[0].error)),d()):(console.log("unexpected error",e,t),i.onerror&&i.onerror(c("generic (Unexpected Error retrieving uploaded file)")),d());if("fileuploadprocessalways"==e.type){var u=t.index,f=t.files[u];if(f.preview&&0===u&&0===n.find("canvas").length){if(a){var p=$(f.preview).css("width","100%");n.find("img").hide(),n.prepend(p)}n.addClass("uploading"),n.find(".progress-bar").css("width",0)}f.error&&(i.onerror&&i.onerror(c(f.error)),d())}if("fileuploadprogressall"==e.type){var v=parseInt(t.loaded/t.total*100,10);n.find(".progress-bar").css("width",v+"%")}},p=u.length-1;p>=0;p--){var v=u[p];r.on(v,f)}$.support.fileInput||r.prop("disabled",!0).parent().addClass("disabled")}};