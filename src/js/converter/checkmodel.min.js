"use strict";var console=require("console"),checkModel=function(e,t,i,r,o){var a,n,s,l=0;if("undefined"==typeof o&&(o=!1),"undefined"!=typeof t&&"function"==typeof t.splice)for(a={},n=0;n<t.length;n++)a[t[n].type]=t[n];else a=t;for(var d in e)if(e.hasOwnProperty(d))if(s="undefined"!=typeof r?r+"."+d:d,i.hasOwnProperty(d))if(typeof i[d]!=typeof e[d])null!==i[d]&&null!==e[d]&&("string"==typeof i[d]?String(e[d])!=e[d]&&(console.log("TODO Different type 1 ",s,typeof i[d],typeof e[d],i[d],e[d]),l=Math.max(l,2)):"number"==typeof i[d]?Number(e[d])!=e[d]&&(console.log("TODO Different type 2 ",s,typeof i[d],typeof e[d],i[d],e[d]),l=Math.max(l,2)):(console.log("TODO Different type 3 ",s,typeof i[d],typeof e[d],i[d],e[d]),l=Math.max(l,2)));else if("object"==typeof e[d])if(null!==e[d])if("undefined"!=typeof e[d].splice){if(e[d].length>0)if(i[d].length>0){var c=0;for(n=0;n<i[d].length;n++)if("string"==typeof i[d][n].type){for(;c<e[d].length&&e[d][c].type!==i[d][n].type;)console.log("ignoring ",s,e[d][c].type," block type in reference not found in model"),c++;if(c>=e[d].length){console.log("WARN cannot find ",s,i[d][n].type," block in reference"),l=Math.max(l,2);break}l=Math.max(l,checkModel(e[d][c],void 0,i[d][n],s+"["+n+"."+i[d][n].type+"]"))}}else for(n=0;n<e[d].length;n++)"string"!=typeof e[d][n].type?(console.log("TODO found an object with no type",s,e[d][n]),l=Math.max(l,2)):a.hasOwnProperty(e[d][n].type)?l=Math.max(l,checkModel(a[e[d][n].type],a,e[d][n],s+"["+n+"."+e[d][n].type+"]")):(console.warn("TODO the model uses a block type not defined by the template. REMOVING IT!!",s,e[d][n]),e[d].splice(n,1),n--,l=Math.max(l,2))}else null===i[d]?o?(console.log("WARN Null object in model ",s,"instead of",e[d],"deleting it"),l=Math.max(l,2),delete e[d]):(console.log("INFO Null object in model ",s,"instead of",e[d],"cloning it from the reference"),l=Math.max(l,1),i[d]=e[d]):l=Math.max(l,checkModel(e[d],a,i[d],s,o));else null!==i[d]&&(console.log("TODO Null in reference but not null in model",s,i[d]),l=Math.max(l,2));else"string"!=typeof e[d]&&"boolean"!=typeof e[d]&&"number"!=typeof e[d]&&(console.log("TODO unsupported type",s,typeof e[d]),l=Math.max(l,2));else o?(console.warn("WARN Property ",s,"found in model is not defined by template: removing it!"),l=Math.max(l,2),delete e[d]):(console.log("INFO Property ",s,"missing in model, cloning from reference!"),l=Math.max(l,1),i[d]=e[d]);return o||(l=Math.max(l,checkModel(i,t,e,"undefined"!=typeof r?r+"!R":"!R",!0))),l};module.exports=checkModel;