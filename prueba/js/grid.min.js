var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,t){var i=this,r=arguments,a=function(){e.type="debouncedresize",$event.dispatch.apply(i,r)};resizeTimeout&&clearTimeout(resizeTimeout),t?a():resizeTimeout=setTimeout(a,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(e){function l(){var r=$(n),o=$(s);i&&(s.length?i.reject(a,r,o):i.resolve(a)),$.isFunction(e)&&e.call(t,a,r,o)}function d(e,t){e.src!==BLANK&&-1===$.inArray(e,o)&&(o.push(e),t?s.push(e):n.push(e),$.data(e,"imagesLoaded",{isBroken:t,src:e.src}),r&&i.notifyWith($(e),[t,a,$(n),$(s)]),a.length===o.length&&(setTimeout(l),a.unbind(".imagesLoaded")))}var t=this,i=$.isFunction($.Deferred)?$.Deferred():0,r=$.isFunction(i.notify),a=t.find("img").add(t.filter("img")),o=[],n=[],s=[];return $.isPlainObject(e)&&$.each(e,function(t,r){"callback"===t?e=r:i&&i[t](r)}),a.length?a.bind("load.imagesLoaded error.imagesLoaded",function(e){d(e.target,"error"===e.type)}).each(function(e,t){var i=t.src,r=$.data(t,"imagesLoaded");return r&&r.src===i?void d(t,r.isBroken):t.complete&&void 0!==t.naturalWidth?void d(t,0===t.naturalWidth||0===t.naturalHeight):void((t.readyState||t.complete)&&(t.src=BLANK,t.src=i))}):l(),i?i.promise(t):t};var Grid=function(){function f(t){v=$.extend(!0,{},v,t),e.imagesLoaded(function(){h(!0),b(),m()})}function p(e){t=t.add(e),e.each(function(){var e=$(this);e.data({offsetTop:e.offset().top,height:e.height()})}),g(e)}function h(e){t.each(function(){var t=$(this);t.data("offsetTop",t.offset().top),e&&t.data("height",t.height())})}function m(){g(t),n.on("debouncedresize",function(){a=0,r=-1,h(),b();var e=$.data(this,"preview");"undefined"!=typeof e&&w()})}function g(e){e.on("click","span.og-close",function(){return w(),!1}).children("a").on("click",function(e){var t=$(this).parent();return i===t.index()?w():y(t),!1})}function b(){s={width:n.width(),height:n.height()}}function y(e){var t=$.data(this,"preview"),i=e.data("offsetTop");if(a=0,"undefined"!=typeof t){if(r===i)return t.update(e),!1;i>r&&(a=t.height),w()}r=i,t=$.data(this,"preview",new k(e)),t.open()}function w(){i=-1;var e=$.data(this,"preview");e.close(),$.removeData(this,"preview")}function k(e){this.$item=e,this.expandedIdx=this.$item.index(),this.create(),this.update()}var s,e=$("#og-grid"),t=e.children("li"),i=-1,r=-1,a=0,o=10,n=$(window),l=$("html, body"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c=d[Modernizr.prefixed("transition")],u=Modernizr.csstransitions,v={minHeight:500,speed:350,easing:"ease"};return k.prototype={create:function(){this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#">Visit website</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),u&&this.setTransition()},update:function(e){if(e&&(this.$item=e),-1!==i){var r=t.eq(i);r.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}i=this.$item.index();var a=this.$item.children("a"),o={href:a.attr("href"),largesrc:a.data("largesrc"),title:a.data("title"),description:a.data("description")};this.$title.html(o.title),this.$description.html(o.description),this.$href.attr("href",o.href);var n=this;"undefined"!=typeof n.$largeImg&&n.$largeImg.remove(),n.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var e=$(this);e.attr("src")===n.$item.children("a").data("largesrc")&&(n.$loading.hide(),n.$fullimage.find("img").remove(),n.$largeImg=e.fadeIn(350),n.$fullimage.append(n.$largeImg))}).attr("src",o.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var e=this,i=function(){u&&$(this).off(c),e.$item.removeClass("og-expanded"),e.$previewEl.remove()};return setTimeout($.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var e=t.eq(this.expandedIdx);e.css("height",e.data("height")).on(c,i),u||i.call()},this),25),!1},calcHeight:function(){var e=s.height-this.$item.data("height")-o,t=s.height;e<v.minHeight&&(e=v.minHeight,t=v.minHeight+this.$item.data("height")+o),this.height=e,this.itemHeight=t},setHeights:function(){var e=this,t=function(){u&&e.$item.off(c),e.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(c,t),u||t.call()},positionPreview:function(){var e=this.$item.data("offsetTop"),t=this.$previewEl.offset().top-a,i=this.height+this.$item.data("height")+o<=s.height?e:this.height<s.height?t-(s.height-this.height):t;l.animate({scrollTop:i},v.speed)},setTransition:function(){this.$previewEl.css("transition","height "+v.speed+"ms "+v.easing),this.$item.css("transition","height "+v.speed+"ms "+v.easing)},getEl:function(){return this.$previewEl}},{init:f,addItems:p}}();