"use strict";var mockery=require("mockery");mockery.enable(),mockery.registerAllowables(["../src/js/converter/declarations.js","console","./utils.js","./domutils.js","console","../bower_components/mensch"]),mockery.registerMock("jquery",require("cheerio")),mockery.registerMock("jsep",require("../bower_components/jsep/src/jsep.js")),mockery.registerMock("mensch/lib/parser.js",function(){var e=require("../bower_components/mensch").parse;return e.apply(e,arguments)});var elaborateDeclarations=require("../src/js/converter/declarations.js"),mockedBindingProvider=function(e,r){return"$"+e+"["+r+"]"},templateUrlConverter=function(e){return e};describe("Template converter",function(){it("should handle basic template conversion",function(){var e=require("../src/js/converter/model.js"),r=require("../src/js/converter/parser.js"),t=[],a=require("jquery"),i=function(e,r,i){t.push({optionalName:r,templateMode:i,html:"object"==typeof e?a.html(e):e})},v='<replacedhtml><replacedhead></replacedhead><repleacedbody><div data-ko-container="main"><div data-ko-block="simpleBlock"><div data-ko-editable="text">block1</div></div></div></replacedbody></replacedhtml>',n=r("template",v,"./basepath/",i),o=[{optionalName:"template",templateMode:"show",html:'<replacedhtml data-bind=""><replacedhead></replacedhead><repleacedbody><div data-bind="block: mainBlocks"></div></repleacedbody></replacedhtml>'},{optionalName:"simpleBlock",templateMode:"show",html:'<div data-bind="attr: { id: id }, uniqueId: $data"><div data-bind="wysiwygId: id()+&apos;_text&apos;, wysiwygClick: function(obj, evt) { $root.selectItem(text, $data); return false }, clickBubble: false, wysiwygCss: { selecteditem: $root.isSelectedItem(text) }, scrollIntoView: $root.isSelectedItem(text), wysiwygOrHtml: text"></div></div>'}];expect(t).toEqual(o);var s=e.generateResultModel(n),c={type:"template",mainBlocks:{type:"blocks",blocks:[]},theme:{type:"theme",bodyTheme:null}};expect(s).toEqual(c)}),it("should handle versafix-1 template conversion",function(){var e=require("../src/js/converter/model.js"),r=require("../src/js/converter/parser.js"),t=[],a=require("jquery"),i=function(e,r,i){t.push({optionalName:r,templateMode:i,html:"object"==typeof e?a.html(e):e})},v=require("fs"),n=""+v.readFileSync("templates/versafix-1/template-versafix-1.html"),o=n.match(/^([\S\s]*)([<]html[^>]*>[\S\s]*<\/html>)([\S\s]*)$/i);if(null===o)throw"Unable to find <html> opening and closing tags in the template";var s=o[2].replace(/(<\/?)(html|head|body)([^>]*>)/gi,function(e,r,t,a){return r+"replaced"+t+a}),c=r("template",s,templateUrlConverter,i),l=e.generateResultModel(c),d=JSON.parse(""+v.readFileSync("spec/data/template-versafix-1.model.json"));expect(l).toEqual(d)})});