"use strict";var path=require("path");module.exports=function(e){e.registerMultiTask("makeThumbs",function(t){var s,r=require("async"),a=this.data,i=this.data.script||"./tasks/lib/phantom-thumbnailer-editor.js",n=this.async();s="undefined"!=typeof t?e.file.expand(a.template.replace("%",t)):e.file.expand(a.templates),e.log.writeln("Creating thumbnails for templates",s),r.eachSeries(s,function(t,r){e.log.writeln("Creating thumbnail",t);var n=path.join(path.dirname(t),a.outputFolder),s=require("phantomjs-prebuilt").path,o=[];o.push(i,a.renderWidth,a.outputWidth,t,n);var l=e.util.spawn({cmd:s,args:o},function(t,a,i){return t?15===i?void e.log.writeln("XXX15"):(e.verbose.or.writeln(),e.log.write("PhantomJS threw an error:").error(),String(a).split("\n").forEach(e.log.error,e.log),void(127===i?(e.log.errorlns("In order for this task to work properly, PhantomJS must be installed locally via NPM. If you're seeing this message, generally that means the NPM install has failed. Please submit an issue providing as much detail as possible at: https://github.com/gruntjs/grunt-lib-phantomjs/issues"),e.warn("PhantomJS not found.",i)):e.warn("PhantomJS exited unexpectedly with exit code "+i+"."))):void r()});l.stdout.pipe(process.stdout),l.stderr.pipe(process.stderr)},function(t){"undefined"!=typeof t&&e.log.writeln(t),n()})})};