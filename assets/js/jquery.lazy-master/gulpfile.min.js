"use strict";var gulp=require("gulp"),util=require("gulp-util"),data=require("gulp-data"),noop=require("gulp-noop"),rename=require("gulp-rename"),header=require("gulp-header"),jshint=require("gulp-jshint"),uglify=require("gulp-uglify"),concat=require("gulp-concat-util"),pkg=require("./package.json"),nl=require("os").EOL,config={header:"/*! jQuery & Zepto Lazy <%= info %> - <%= pkg.homepage %> - MIT&GPL-2.0 license - Copyright 2012-<%= year %> <%= pkg.author.name %> */",main:pkg.main,plugins:["plugins/jquery.lazy.*.js","!plugins/jquery.lazy.*.min.js"]},pipes={};pipes.validateFiles=function(e){return gulp.src(e,{base:"./"}).pipe(jshint()).pipe(jshint.reporter("jshint-stylish"))},pipes.validate=function(){return pipes.validateFiles([config.main].concat(config.plugins))},pipes.buildMain=function(){return pipes.validateFiles(config.main).pipe(uglify()).pipe(header(config.header+nl,{pkg:pkg,info:"v"+pkg.version,year:(new Date).getFullYear()})).pipe(rename(function(e){e.extname=".min"+e.extname})).pipe(gulp.dest("./"))},pipes.buildPlugins=function(){return pipes.validateFiles(config.plugins).pipe(data(function(e){var t=String(e.contents).split("\n")[1],i=t.match(/\s-\s([a-z ]+)\s-\sv([0-9.]+)/i);return{info:"- "+i[1]+" v"+i[2]}})).pipe(uglify()).pipe(header(config.header+nl,{pkg:pkg,year:(new Date).getFullYear()})).pipe(rename(function(e){e.extname=".min"+e.extname})).pipe(gulp.dest("./"))},pipes.concatPlugins=function(){return gulp.src(config.plugins).pipe(concat(config.main.replace(".js",".plugins.js"),{sep:nl+nl})).pipe(gulp.dest("./")).pipe(uglify()).pipe(header(config.header+nl,{pkg:pkg,info:"- All Plugins v"+pkg.version,year:(new Date).getFullYear()})).pipe(rename(function(e){e.extname=".min"+e.extname})).pipe(gulp.dest("./"))},gulp.task("build",["build-main","build-plugins","concat-plugins"]),gulp.task("build-main",pipes.buildMain),gulp.task("build-plugins",pipes.buildPlugins),gulp.task("concat-plugins",pipes.concatPlugins),gulp.task("validate",pipes.validate),gulp.task("watch",["build"],function(){gulp.watch(config.main,function(){var e=pipes.buildMain();return util.log("updated","'"+util.colors.red("main file")+"'"),e}),gulp.watch(config.plugins,function(){var e=pipes.buildPlugins();return util.log("updated","'"+util.colors.red("plugins")+"'"),pipes.concatPlugins(),util.log("updated","'"+util.colors.red("concatenated plugins file")+"'"),e})});